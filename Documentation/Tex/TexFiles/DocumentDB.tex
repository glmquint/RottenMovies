\include{./preamble}
\begin{document}
\chapter{Document database}
\justifying
In this chapter we will discuss of the organization of the document database and how we handled the replicas.

We decided to use MongoDB as DBMS for the document database for the purpose of storing the main information for movies, users, reviews and personnel. In MongoDB we created the following three collection: 
\begin{itemize}
	\item movie
	\item user
\end{itemize}
Inside the movie collection there are embedded the documents for the reviews and personnel
\section{Collection composition}
\subsection{Movie collection}
The following is the composition of the Movie collection.
\lstinputlisting[language=json]{./../code/movie.json}
As previously stated the field personnel and review are arrays of embedded documents.
\paragraph{}
\subsection{User collection}
The following is the composition of the User collection.
\lstinputlisting[language=json]{./../code/user.json}
Is important to notice that in this collection we have two fields for the reviews, \emph{last3Reviews} and \emph{reviews} which present different ways of storing data for the same underling entity. As suggested by the name itself \emph{last3Reviews} contains the last three review in the form of an embedded document meanwhile \emph{reviews} contains all the reviews made by a user in the form of document linking towards the movie for which they were written; in particular, the link is formed by the id of the movie, the title and the position in which the review can be found in the array \emph{review} of the movie document. This structure was chosen so that we could avoid a full replica of the reviews in both collections and, at the same time, avoiding to perform join operation for those reviews that are more frequently checked, which are the most recent ones. The idea of creating a separated collection for reviews was immediately discarded because it would have resorted in a design for the document database that resemble a third normal form of relational database.

\section{Indexes}
\blindtext
\section{Partition and replicas}
\blindtext
\end{document}